#!/bin/sh
# For license: see LICENSE file at top-level

progname="`basename $0`"

# possibly from environment
launcher="${SHMEM_LAUNCHER-}"

if [ -z "$launcher" ]
then
    # possibly from configure
    launcher="@SHMEM_LAUNCHER@"
fi

if [ -z "$launcher" ]
then
    launcher=prun
fi

if [ "$launcher" = "prun" ]
then
    #
    # wait for daemon to be ready, & then record pid (sleep is nasty
    # fudge for now)
    #
    prte --daemonize
    sleep 1
    prte_pid="`pgrep -x -U $USER prte`"
fi

$launcher "$@"
err=$?

if [ "$launcher" = "prun" ]
then
    #
    # clean up prte daemon
    #
    kill -TERM $prte_pid
fi

exit $err
